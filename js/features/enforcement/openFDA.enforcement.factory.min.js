(function(){angular.module("openFDA.enforcement.factory",[]).factory("enforcementFactory",["$q","enforcementData",function(f,e){function h(b){return b.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}this.getMapData=function(b,a){var c=f.defer();e.getEnforcementCount(b,a,"state").then(function(a){var b={choropleth:[]};angular.forEach(a.results,function(d){var g;a:{g=d.term.toUpperCase();var a=[{id:1,name:"Alabama",di:"AL"},{id:2,name:"Alaska",di:"AK"},{id:4,
name:"Arizona",di:"AZ"},{id:5,name:"Arkansas",di:"AR"},{id:6,name:"California",di:"CA"},{id:8,name:"Colorado",di:"CO"},{id:9,name:"Connecticut",di:"CT"},{id:10,name:"Delaware",di:"DE"},{id:12,name:"Florida",di:"FL"},{id:13,name:"Georgia",di:"GA"},{id:15,name:"Hawaii",di:"HI"},{id:16,name:"Idaho",di:"ID"},{id:17,name:"Illinois",di:"IL"},{id:18,name:"Indiana",di:"IN"},{id:19,name:"Iowa",di:"IA"},{id:20,name:"Kansas",di:"KS"},{id:21,name:"Kentucky",di:"KY"},{id:22,name:"Louisiana",di:"LA"},{id:23,name:"Maine",
di:"ME"},{id:24,name:"Maryland",di:"MD"},{id:25,name:"Massachusetts",di:"MA"},{id:26,name:"Michigan",di:"MI"},{id:27,name:"Minnesota",di:"MN"},{id:28,name:"Mississippi",di:"MS"},{id:29,name:"Missouri",di:"MO"},{id:30,name:"Montana",di:"MT"},{id:31,name:"Nebraska",di:"ME"},{id:32,name:"Nevada",di:"MV"},{id:33,name:"New Hampshire",di:"NH"},{id:34,name:"New Jersey",di:"NJ"},{id:35,name:"New Mexico",di:"NM"},{id:36,name:"New York",di:"NY"},{id:37,name:"North Carolina",di:"NC"},{id:38,name:"North Dakota",
di:"ND"},{id:39,name:"Ohio",di:"OH"},{id:40,name:"Oklahoma",di:"OK"},{id:41,name:"Oregon",di:"OR"},{id:42,name:"Pennsylvania",di:"PA"},{id:44,name:"Rhode Island",di:"RI"},{id:45,name:"South Carolina",di:"SC"},{id:46,name:"South Dakota",di:"SD"},{id:47,name:"Tennessee",di:"TN"},{id:48,name:"Texas",di:"TX"},{id:49,name:"Utah",di:"UT"},{id:50,name:"Vermont",di:"VT"},{id:51,name:"Virginia",di:"VA"},{id:53,name:"Washington",di:"WA"},{id:54,name:"West Virginia",di:"WV"},{id:55,name:"Wisconsin",di:"WI"},
{id:56,name:"Wyoming",di:"WY"}];for(i=0;i<a.length;i++)if(a[i].di==g){g=a[i].id;break a}g=void 0}b.choropleth.push({x:g,y:d.count})});c.resolve(b)});return c.promise};this.getChartData=function(b,a){var c=f.defer();e.getEnforcementCount(b,'status:"ongoing"+AND+'+a,"city.exact").then(function(a){var b=[],d="#A6A6A6";angular.forEach(a.results,function(a){switch(!0){case 7>=a.count:d="#2C82C0";break;case 15>=a.count:d="#4C89A7";break;case 23>=a.count:d="#6D918F";break;case 30>=a.count:d="#8D9976";break;
case 38>=a.count:d="#AEA15E";break;case 46>=a.count:d="#CEA945";break;case 53>=a.count:d="#EFB12D";break;case 61>=a.count:d="#EA9D28";break;case 69>=a.count:d="#E58923";break;case 76>=a.count:d="#E0751E";break;case 84>=a.count:d="#DB6119";break;case 92>=a.count:d="#D64D14";break;case 92<a.count:d="#D23A0F"}var c=a.term;b.push({key:c,keyID:c,label1:"Ongoing",value1:a.count,color1:d})});b=b.slice(0,10);c.resolve(b)});return c.promise};this.getStatusData=function(b,a){var c=f.defer();e.getEnforcementCount(b,
a,"status").then(function(a){var b={title:"",data:[]};angular.forEach(a.results,function(a){b.data.push({title:h(a.term),number:a.count})});c.resolve(b)});return c.promise};this.getAllEnforcementData=function(b,a){return e.getEnforcementData(b,a,"100")};this.getFiveLatestRecalls=function(){var b=f.defer(),a=[],c=[];a.push(e.getEnforcementData("food",'country:"US"',"100"));a.push(e.getEnforcementData("drug",'country:"US"',"100"));a.push(e.getEnforcementData("device",'country:"US"',"100"));f.all(a).then(function(a){c=
a[0].results.concat(a[1].results,a[2].results);c=_.sortBy(c,function(a){return a.recall_initiation_date});c=_.last(c,5);c.reverse();b.resolve(c)});return b.promise};return this}])})();