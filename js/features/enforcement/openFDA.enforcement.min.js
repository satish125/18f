(function(){angular.module("openFDA.enforcement",["openFDA.enforcement.factory"]).controller("enforcementCtrl",["$scope","$timeout","$q","$window","enforcementFactory",function(a,g,h,m,d){function k(b){b=b.results;e.data().any()&&e.clear();angular.forEach(b,function(b,n){b.recall_initiation_date&&(b.recall_initiation_date=a.addDashes(b.recall_initiation_date))});e.rows.add(b).draw();l()}function l(){var a=$(".datagridcol").width();$(".datagrid").width(a);e.responsive.rebuild();e.responsive.recalc()}
function f(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}a.getMap=function(b,c){return d.getMapData(a.type,'status:"'+b+'"+AND+classification:"'+c+'"').then(function(b){a.mapData=b;a.mapLabel="Map - "+c+" Ongoing "+f(a.type)+" Recalls"})};a.getChart=function(b){return d.getChartData(a.type,'classification:"'+b+'"').then(function(c){a.chartData=c;a.chartLabel="Top 10 Cities - "+b+" "+f(a.type)+" Recalls"})};a.getStatus=function(b){return d.getStatusData(a.type,
'classification:"'+b+'"').then(function(c){a.statusData=c;a.statusLabel="Status - "+b+" "+f(a.type)+" Recalls"})};a.setDataTable=function(b,c){return d.getAllEnforcementData(a.type,'classification:"'+b+'"'+(c||"")).then(function(b){a.pageState.isLoading||k(b);return b})};a.selectType=function(b){a.type=b;a.titleLabel=f(b)+" Recalls";return a.selectClass(a.classif)};a.selectClass=function(b){a.classif=b;var c="";switch(b){case "Class I":c="CLASS I - Dangerous or defective products that predictably could cause serious health problems or death. Examples include: food found to contain botulinum toxin, food with undeclared allergens, a label mix-up on a lifesaving drug, or a defective artificial heart valve.";
break;case "Class II":c="CLASS II - Products that might cause a temporary health problem, or pose only a slight threat of a serious nature. Example: a drug that is under-strength but that is not used to treat life-threatening situations.";break;case "Class III":c="CLASS III - Products that are unlikely to cause any adverse health reaction, but that violate FDA labeling or manufacturing laws. Examples include: a minor container defect and lack of English labeling in a retail food."}a.classInfo=c;return h.all([a.getMap("ongoing",
b),a.getChart(b),a.getStatus(b),a.setDataTable(b)])};a.$on("mapChart:click",function(b,c){a.setDataTable(a.classif,'+AND+state:"'+c.di+'"')});a.$on("hbarChart:click",function(b,c){a.setDataTable(a.classif,'+AND+city:"'+c.x+'"')});angular.element(m).on("resize",function(){a.$broadcast("event:windowResize");l()});$("#datagridinfo").on("page.dt",function(){$("html,body").animate({scrollTop:$(".datagridcol").offset().top},"slow")});var e=void 0;(function(){a.pageState={isLoading:!0};a.type="food";a.classif=
"Class I";var b=d.getFiveLatestRecalls().then(function(b){a.lastestRecalls=b});h.all([a.selectType(a.type),b]).then(function(b){g(function(){a.pageState.isLoading=!1},0);return b[0][3]}).then(function(a){g(function(){e=$("#datagridinfo").DataTable({order:[[0,"desc"]],columns:[{data:"recall_initiation_date"},{data:"city"},{data:"state"},{data:"recalling_firm"},{data:"product_quantity",defaultContent:"Unknown"},{data:"status"},{data:"product_description"},{data:"reason_for_recall"}],pagingType:"simple",
responsive:!0});k(a)},300)})})();a.mapOptions={chart:{margin:{top:0,right:35,bottom:0,left:35},type:"map",backgroundColor:"transparent",colors:"#2C82C0 #4C89A7 #6D918F #8D9976 #AEA15E #CEA945 #EFB12D #EA9D28 #E58923 #E0751E #DB6119 #D64D14 #D23A0F".split(" ")},tooltip:{suffix:" Recall(s)",undefinedAsZero:!0},types:{map:{mapfile:"us-states",quantizeScale:[0,100],showPoints:!1}}};a.chartOptions={chart:{margin:{left:130,right:50,bottom:50},type:"hbar",backgroundColor:"transparent",colors:["#A6A6A6"]},
tooltip:{suffix:" Recall(s)"},xAxis:{title:{text:"Recalls"},spacing:.25},yAxis:{title:{text:"City"},labels:{enabled:!0},ticks:5},types:{bar:{labels:{enabled:!0},stacked:!0}}};a.addDashes=function(a){a=a.toString().split("");for(var c=a.length,e=[],d=0;d<c;d++)e.push(a[d]),3==d?e.push("-"):5==d&&e.push("-");return e.join("")}}])})();